[자바스크립트의 변수 (2)]
=============
### 자바스크립트는 브라우저 환경에서 돌아가도록 만들어졌기 때문에 글로벌 영역도 하나의 변수로 정의하여 사용하며, 이 영역은 window 객체가 관장한다.
- 단 하나만 존재 (GLOBAL OBJECT)
- 어떤 컨텍스트가 *실행*되기 전 먼저 생성
- new, 함수호출, 프로토타입 X
- 자기 자신을 포함한 글로벌 영역의 변수 모두를 *속성*으로 가짐 
  <pre>
    window.window.window.window === window
  </pre>

### 선언방법 및 차이
- window.global, window["global"]  처럼 직접 추가
  > 이 경우 window 객체가 재선언되지 않은 경우에 유효
  
- 글로벌 스코프에서 var 키워드 선언
  <pre>
    console.log(sskim + " window has 'sskim' as its own property already? " + window.hasOwnProperty("sskim"));
    var sskim = "hello javascript";
    console.log(sskim);
    console.log("=========");
  </pre>
  > 글로벌 영역에 변수로는 선언되어있으나 첫번째 줄에서는 undefined 출력
  
- 상위 스코프에 변수명 없이 바로 선언
  <pre>
    console.log(sskim2 + " window has 'sskim2' as its own property already? " + window.hasOwnProperty("sskim2"));
    sskim2 = "hello javascript";
    console.log(sskim2);
    console.log("=========");
  </pre>
  > Error. where and why?   
  
### VAR
- 실행 환경의 초기화시 같은 컨텍스트 내부에 선언된 var 정의 위치
  <pre>
    function sskim(flag) {
      var c;
      if (flag){
        var a;
        console.log(a);
        console.log(b);
        console.log(c);
      } else {
        var b;        
        console.log(a);
        console.log(b);
        console.log(c);
      }
    }
    
    sskim(true);
    console.log("=========");
    sskim(false);
    console.log("=========");
  </pre>
  > Lexical Environment 환경 레코드 설정 단계에서 var 로 선언된 모든 변수를 미리 찾아 undefined 할당하기 때문에, 같은 컨텍스트 (함수) 내부 어느 곳에서 선언하든 성능에 차이가 없음
  
- 그럼에도 불구하고 권장사항
  <pre>
    function sskim() {
      var a;
      for (var i = 0; i < items.length; i++){
        var item = items[i];
        ...
      }
    }
        
    function sskim() {
      var a, i, len, item;
      for (i = 0, len = items.length; i < len; i++){
        var item = items[i];
        ...
      }
    }
  </pre>
  > why? *초기화 실수*의 최소화, 해당 스코프에서 사용되는 *변수 관리* 용이, *minification* 최소화
  
  1. 초기화 실수    
    <pre>
      var sskim4;
      console.log(window.sskim4);
      console.log(window.sskim5);
      console.log("=========");
    </pre>
    > 변수를 선언한 후 기본값을 undefined로 그냥 두기보다는 null, 0 등으로 할당하여 **변수 선언/초기화 확인 구분 필요**
    
  2. 변수 관리 용이
    <pre>
      var items = [1,2,3,4,5];
      for (var i = 0, len = items.length; i < len; i++){
        var item = items[i];
        for (var i = 0; i < 3; i++){
          alert(item);
        }
      }
    </pre>
    > 무한루프. why?
    
  3. minification
    > 웹이라는 환경에서 동작하는 만큼, 자바스크립트는 소스의 크기를 줄이는 것이 상당히 중요. 가장 중요한 이유
    
### 글로벌 변수 최소화
- 클로저 이용
  <pre>
    (function(){
      var sskim = "good evening javascript";
    }());
  </pre>
  
- 모듈/네임스페이스 패턴 이용
  <pre>
    (function(window){
      var local = "I'm local";
      
      window.module = {
        show: function(){
          alert(local);
        },
        change: function(sentence){
          local = sentence;
        }
      };
    })(window);
    
    module.show();
    module.change("You're not local");
    module.show();
  </pre>
  
  > widget.generator 참조
  
### 변수 사용 방법 및 성능
- 위와 같이 자바스크립트에서는 굉장히 유연한 변수의 선언 및 사용이 가능하기 때문에 코딩할 때 성능을 고려하는 버릇을 들여야 함
  <pre>
    var div = document.getElementById("div");
    (function(){
      //do not
      {
        div.style.a = 1;
        div.style.b = 2;
        div.style.c = 3;
        ...
      }
      
      //do
      {
        var style = div.style;
        style.a = 1;
        style.b = 2;
        style.c = 3;
        ...
      }
    })();
  </pre>
  
  
## 정리
### 글로벌 변수의 사용을 자제하고 클로저, 패턴 등으로 대체
### var 키워드는 실행 컨텍스트 생성 시점에 모두 생성하여 undefined 자동할당, 따라서 해당 함수 시작지점에 한번에 선언 권장
### 자바스크립트의 성능을 고려하여 상위 스코프 참조는 최소화
